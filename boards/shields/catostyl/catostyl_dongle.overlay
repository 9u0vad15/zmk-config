#include "catostyl.dtsi"

/ {
    // chosen {
    //     zephyr,display = &oled;
    // };

    pim447_listener: pim447_listener {
        compatible = "zmk,input-listener";
        status = "okay";
        device = <&pimoroni_pim447>;
    };
};

&kscan0 {
    compatible = "zmk,kscan-mock";
    columns = <0>;
    rows = <0>;
    events = <0>;
};

&pro_micro_i2c {
    // #address-cells = <1>;
    // #size-cells = <0>;

    status = "okay";
    clock-frequency = <I2C_BITRATE_STANDARD>;
    // I2C_BITRATE_STANDARD   100000
    // I2C_BITRATE_FAST   400000
    // I2C_BITRATE_FAST_PLUS   1000000
    // I2C_BITRATE_HIGH   3400000
    // I2C_BITRATE_ULTRA   5000000

    pimoroni_pim447: pimoroni_pim447@a {
        compatible = "zmk,pimoroni-pim447";
        status = "okay";
        reg = <0x0a>;
        int-gpios = <&pro_micro 4 (GPIO_PULL_UP | GPIO_ACTIVE_LOW)>;

        automouse-layer = <0>;
        swap-axes;
		invert-move-x;
		power-layer = <0>; /* MOUSE layer */
		//idle-timeout = <10>; /* in seconds */

		/* Modified from,
		 * https://gitlab.com/voidyourwarranty/zmk-yackboard/-/blob/0f6f8e19688af082116604acf793aca25d5de1f1/app/boards/shields/yackboard/yackboard_right.overlay
		 */
		mode = <PIM447_MOVE>;        // default: PIM447_MOVE for mouse move; alternatives: PIM447_SCROLL for scroll wheel, PIM447_TOGGLE for toggle on button press
		move-factor-x = <250>;       // Sensitivity X; default: 100
		move-factor-y = <250>;       // Sensitivity Y; default: 100
		move-inertia-x = <66>;       // Inertia X, between 0 (no inertia) and 99 (huge inertia); default: 0; note that some inertia is needed for acceleration
		move-inertia-y = <66>;       // Inertia Y, between 0 (no inertia) and 99 (huge inertia); default: 0; note that some inertia is needed for acceleration
		norm = <PIM447_NORM_EUCLID>; // Metric for 2d distance measurement; default: PIM447_NORM_EUCLID; alternative: PIM447_NORM_MAX in order to enhance diagonal movement
		exactness = <4>;             // Range of small velocities that are not accelerated
		max-accel = <250>;           // Maximum acceleration; default: 100
		scroll-divisor-x = <1>;      // Increase wheel velocity (default: 2)
		scroll-divisor-y = <1>;      // Increase wheel velocity (default: 2)
		invert-scroll-x;             // Invert wheel X axis (left is right, and vice versa)
		button = <0>;                // Send mouse button 4 when pressing the ball which is usually ignored by the operating system (default: 0, ie. left-click)
		poll-interval = <10>;        // Interval in milli-seconds at which the track ball is polled (default: 50)
    };

    // oled: ssd1306@3c {
    //     compatible = "solomon,ssd1306fb";
    //     // status = "okay";
    //     reg = <0x3c>;
    //     width = <128>;
    //     height = <64>;
    //     segment-offset = <0>;
    //     page-offset = <0>;
    //     display-offset = <0>;
    //     multiplex-ratio = <63>;
    //     segment-remap;
    //     com-invdir;
    //     com-sequential;
    //     inversion-on;
    //     prechargep = <0x22>;
    // };
};

// &pim447_listener {
//     status = "okay";
//     device = <&pim447>;
// };
